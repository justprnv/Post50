{% extends "base.html" %}

{% block content %}
<div class="profile">
    {% if user.avatar_path %}
    <img src="{{ user.avatar_path }}" alt="Profile picture" class="avatar-large">
    {% else %}
    <div class="avatar-large avatar-placeholder" style="width: 120px; height: 120px; font-size: 3rem;">
        {{ user.username[0].upper() }}
    </div>
    {% endif %}
    <h2>{{ user.username }}</h2>
    <p>Member since {{ user.created_at.strftime('%B %Y') }}</p>
</div>

<div class="posts-feed">
    <h2 style="margin-bottom: 24px; color: var(--text-primary);">Recent Posts by {{ user.username }}</h2>
    
    {% for post in posts %}
    <div class="post-card" data-post-id="{{ post.id }}">
        <div class="post-header">
            <div class="post-emoji">📝</div>
            <div class="post-title">{{ post.title | safe }}</div>
        </div>
        
        <div class="post-meta">
            <span class="post-date">{{ post.created_at.strftime('%B %d, %Y') }}</span>
        </div>
        
        <div class="post-content">{{ post.content | safe }}</div>
        
        {% if post.image_path %}
        <img src="{{ post.image_path }}" alt="Post image" class="post-image">
        {% endif %}
        
        {% if post.tags %}
        <div class="post-tags">
            {% for tag in post.tags %}
            <span class="tag">#{{ tag.name }}</span>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="post-footer">
            <div class="post-actions">
                <button class="action-btn" onclick="votePost({{ post.id }}, 'up')" data-vote-type="up">
                    👍 <span class="score">{{ post.upvotes }}</span>
                </button>
                <button class="action-btn" onclick="votePost({{ post.id }}, 'down')" data-vote-type="down">
                    👎 <span class="score">{{ post.downvotes }}</span>
                </button>
                <button class="action-btn" onclick="toggleComments({{ post.id }})">
                    💬 <span class="comment-count">{{ post.comments|length }}</span>
                </button>
            </div>
            
            {% if current_user.is_authenticated and post.author_id == current_user.id %}
            <div class="post-manage">
                <a href="{{ url_for('post_edit', post_id=post.id) }}" class="btn btn-outline manage-btn">Edit</a>
                <button class="btn btn-danger manage-btn" onclick="deletePost({{ post.id }})">Delete</button>
            </div>
            {% endif %}
        </div>
        
        <!-- Comments Section -->
        <div id="comments-{{ post.id }}" class="comment-list" style="display: none;">
            {% for comment in post.comments %}
            <div class="comment">
                <strong>{{ comment.author.username }}</strong>: {{ comment.content }}
            </div>
            {% endfor %}
            
            {% if current_user.is_authenticated %}
            <form onsubmit="addComment(event, {{ post.id }})" style="margin-top: 16px;">
                <input type="text" placeholder="Add a comment..." class="form-input" id="comment-{{ post.id }}" required>
                <button type="submit" class="btn btn-primary" style="margin-top: 8px;">Comment</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    
    {% if not posts %}
    <div class="form-card" style="text-align: center;">
        <p style="color: var(--text-muted); font-size: 1.1rem;">No posts yet from {{ user.username }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}
