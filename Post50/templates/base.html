<!doctype html>
<html lang="en" data-theme="system">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Post50 - Share Your Stories</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script>
    // Prevent theme flashing by applying theme immediately
    (function() {
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
</head>
<body>
  <div id="app">
    <!-- Navigation Header -->
    <header class="nav-header">
      <div class="nav-container">
        <div class="nav-brand">
          <a href="{{ url_for('index') }}" class="brand-link">
            <h1 class="brand-text">Post50</h1>
          </a>
        </div>
        
        <div class="nav-search">
          <form id="searchForm" action="{{ url_for('index') }}" method="get">
            <input type="text" name="q" id="searchInput" placeholder="Search posts..." class="search-input" value="{{ request.args.get('q','') }}">
            <div class="search-icon">ğŸ”</div>
          </form>
        </div>
        
        <div class="nav-actions">
          <button id="themeToggle" class="theme-toggle" role="switch" aria-checked="false" aria-label="Toggle theme">
            <div class="theme-toggle-track">
              <div class="theme-toggle-thumb"></div>
            </div>
          </button>
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('post_new') }}" class="btn btn-primary">ğŸ“ New Post</a>
            <a href="{{ url_for('settings') }}" class="btn btn-secondary">âš™ï¸</a>
            <a href="{{ url_for('profile', user_id=current_user.id) }}" class="btn btn-outline">
              {% if current_user.avatar_path %}
                <img src="{{ current_user.avatar_path }}" class="avatar" alt="avatar">
              {% else %}
                <span class="avatar-placeholder">{{ current_user.username[0].upper() }}</span>
              {% endif %}
            </a>
            <a href="{{ url_for('logout') }}" class="btn btn-outline">Logout</a>
          {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-primary">Login</a>
            <a href="{{ url_for('register') }}" class="btn btn-outline">Register</a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      {% block content %}{% endblock %}
    </main>

    <!-- Flash Messages -->
    <div id="flashMessages" class="flash-messages">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <script>
    window.IS_AUTHENTICATED = {{ 'true' if current_user.is_authenticated else 'false' }};
  </script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
